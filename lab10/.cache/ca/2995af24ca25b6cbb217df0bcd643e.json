{"id":"node_modules/@tensorflow/tfjs-backend-webgl/dist/crop_and_resize_gpu.js","dependencies":[{"name":"/home/richardrose/pet-theory/lab10/node_modules/@tensorflow/tfjs-backend-webgl/dist/crop_and_resize_gpu.js.map","includedInParent":true,"mtime":1624262086654},{"name":"/home/richardrose/pet-theory/lab10/node_modules/@tensorflow/tfjs-backend-webgl/src/crop_and_resize_gpu.ts","includedInParent":true,"mtime":1624262086575},{"name":"/home/richardrose/pet-theory/lab10/package.json","includedInParent":true,"mtime":1624262100639},{"name":"/home/richardrose/pet-theory/lab10/node_modules/@tensorflow/tfjs-backend-webgl/package.json","includedInParent":true,"mtime":1624262088369}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CropAndResizeProgram = void 0;\n\n/**\n * @license\n * Copyright 2017 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nclass CropAndResizeProgram {\n  constructor(imageShape, boxShape, cropSize, method, extrapolationValue) {\n    this.variableNames = ['Image', 'Boxes', 'BoxInd'];\n    this.outputShape = [];\n    const [batch, imageHeight, imageWidth, depth] = imageShape;\n    const [numBoxes] = boxShape;\n    const [cropHeight, cropWidth] = cropSize;\n    this.outputShape = [numBoxes, cropHeight, cropWidth, depth];\n    const methodId = method === 'bilinear' ? 1 : 0;\n    const [inputHeightFloat, inputWidthFloat] = [`${imageHeight - 1}.0`, `${imageWidth - 1}.0`];\n    const [heightRatio, heightScale, inY] = cropHeight > 1 ? [`${(imageHeight - 1) / (cropHeight - 1)}`, '(y2-y1) * height_ratio', `y1*${inputHeightFloat} + float(y)*(height_scale)`] : ['0.0', '0.0', `0.5 * (y1+y2) * ${inputHeightFloat}`];\n    const [widthRatio, widthScale, inX] = cropWidth > 1 ? [`${(imageWidth - 1) / (cropWidth - 1)}`, '(x2-x1) * width_ratio', `x1*${inputWidthFloat} + float(x)*(width_scale)`] : ['0.0', '0.0', `0.5 * (x1+x2) * ${inputWidthFloat}`]; // Reference implementation\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/crop_and_resize_op_gpu.cu.cc\n\n    this.userCode = `\n      const float height_ratio = float(${heightRatio});\n      const float width_ratio = float(${widthRatio});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${batch}) {\n          return;\n        }\n\n        float height_scale = ${heightScale};\n        float width_scale = ${widthScale};\n\n        float in_y = ${inY};\n        if( in_y < 0.0 || in_y > ${inputHeightFloat} ) {\n          setOutput(float(${extrapolationValue}));\n          return;\n        }\n        float in_x = ${inX};\n        if( in_x < 0.0 || in_x > ${inputWidthFloat} ) {\n          setOutput(float(${extrapolationValue}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${methodId} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `;\n  }\n\n}\n\nexports.CropAndResizeProgram = CropAndResizeProgram;"},"sourceMaps":{"js":{"mappings":[{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":8,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":20,"column":6},"generated":{"line":24,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":20,"column":13},"generated":{"line":24,"column":6}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":20,"column":6},"generated":{"line":24,"column":26}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":20,"column":33},"generated":{"line":24,"column":27}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":25,"column":2},"generated":{"line":25,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":25,"column":2},"generated":{"line":25,"column":2}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":25,"column":2},"generated":{"line":25,"column":13}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":26,"column":6},"generated":{"line":25,"column":14}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":25,"column":2},"generated":{"line":25,"column":24}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":26,"column":52},"generated":{"line":25,"column":26}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":25,"column":2},"generated":{"line":25,"column":34}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":27,"column":6},"generated":{"line":25,"column":36}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":25,"column":2},"generated":{"line":25,"column":44}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":27,"column":34},"generated":{"line":25,"column":46}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":25,"column":2},"generated":{"line":25,"column":52}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":28,"column":6},"generated":{"line":25,"column":54}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":25,"column":2},"generated":{"line":25,"column":72}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":28,"column":32},"generated":{"line":25,"column":74}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":21,"column":2},"generated":{"line":26,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":21,"column":2},"generated":{"line":26,"column":9}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":21,"column":2},"generated":{"line":26,"column":22}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":21,"column":18},"generated":{"line":26,"column":25}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":21,"column":19},"generated":{"line":26,"column":26}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":21,"column":18},"generated":{"line":26,"column":33}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":21,"column":28},"generated":{"line":26,"column":35}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":21,"column":18},"generated":{"line":26,"column":42}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":21,"column":37},"generated":{"line":26,"column":44}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":21,"column":18},"generated":{"line":26,"column":52}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":21,"column":2},"generated":{"line":26,"column":53}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":22,"column":2},"generated":{"line":27,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":22,"column":2},"generated":{"line":27,"column":9}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":22,"column":2},"generated":{"line":27,"column":20}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":22,"column":26},"generated":{"line":27,"column":23}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":22,"column":2},"generated":{"line":27,"column":25}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":29,"column":4},"generated":{"line":28,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":29,"column":10},"generated":{"line":28,"column":10}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":29,"column":11},"generated":{"line":28,"column":11}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":29,"column":10},"generated":{"line":28,"column":16}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":29,"column":18},"generated":{"line":28,"column":18}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":29,"column":10},"generated":{"line":28,"column":29}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":29,"column":31},"generated":{"line":28,"column":31}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":29,"column":10},"generated":{"line":28,"column":41}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":29,"column":43},"generated":{"line":28,"column":43}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":29,"column":10},"generated":{"line":28,"column":48}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":29,"column":52},"generated":{"line":28,"column":52}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":29,"column":4},"generated":{"line":28,"column":62}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":30,"column":4},"generated":{"line":29,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":30,"column":10},"generated":{"line":29,"column":10}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":30,"column":11},"generated":{"line":29,"column":11}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":30,"column":10},"generated":{"line":29,"column":19}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":30,"column":25},"generated":{"line":29,"column":23}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":30,"column":4},"generated":{"line":29,"column":31}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":31,"column":4},"generated":{"line":30,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":31,"column":10},"generated":{"line":30,"column":10}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":31,"column":11},"generated":{"line":30,"column":11}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":31,"column":10},"generated":{"line":30,"column":21}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":31,"column":23},"generated":{"line":30,"column":23}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":31,"column":10},"generated":{"line":30,"column":32}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":31,"column":36},"generated":{"line":30,"column":36}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":31,"column":4},"generated":{"line":30,"column":44}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":32,"column":4},"generated":{"line":31,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":32,"column":9},"generated":{"line":31,"column":9}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":32,"column":4},"generated":{"line":31,"column":20}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":32,"column":23},"generated":{"line":31,"column":23}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":32,"column":24},"generated":{"line":31,"column":24}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":32,"column":23},"generated":{"line":31,"column":32}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":32,"column":34},"generated":{"line":31,"column":34}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":32,"column":23},"generated":{"line":31,"column":44}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":32,"column":46},"generated":{"line":31,"column":46}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":32,"column":23},"generated":{"line":31,"column":55}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":32,"column":57},"generated":{"line":31,"column":57}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":32,"column":23},"generated":{"line":31,"column":62}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":32,"column":4},"generated":{"line":31,"column":63}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":33,"column":4},"generated":{"line":32,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":33,"column":10},"generated":{"line":32,"column":10}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":33,"column":18},"generated":{"line":32,"column":18}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":33,"column":21},"generated":{"line":32,"column":21}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":33,"column":27},"generated":{"line":32,"column":27}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":33,"column":32},"generated":{"line":32,"column":32}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":33,"column":21},"generated":{"line":32,"column":42}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":33,"column":45},"generated":{"line":32,"column":45}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":33,"column":21},"generated":{"line":32,"column":46}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":33,"column":49},"generated":{"line":32,"column":49}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":33,"column":4},"generated":{"line":32,"column":50}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":35,"column":4},"generated":{"line":33,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":35,"column":10},"generated":{"line":33,"column":10}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":35,"column":11},"generated":{"line":33,"column":11}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":35,"column":10},"generated":{"line":33,"column":27}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":35,"column":29},"generated":{"line":33,"column":29}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":35,"column":10},"generated":{"line":33,"column":44}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":36,"column":8},"generated":{"line":33,"column":48}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":36,"column":9},"generated":{"line":33,"column":49}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":36,"column":12},"generated":{"line":33,"column":52}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":36,"column":23},"generated":{"line":33,"column":63}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":36,"column":26},"generated":{"line":33,"column":66}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":36,"column":27},"generated":{"line":33,"column":67}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":36,"column":8},"generated":{"line":33,"column":71}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":36,"column":33},"generated":{"line":33,"column":73}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":36,"column":36},"generated":{"line":33,"column":76}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":36,"column":46},"generated":{"line":33,"column":86}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":36,"column":49},"generated":{"line":33,"column":89}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":36,"column":50},"generated":{"line":33,"column":90}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":36,"column":8},"generated":{"line":33,"column":94}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":35,"column":4},"generated":{"line":33,"column":95}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":4},"generated":{"line":34,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":10},"generated":{"line":34,"column":10}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":11},"generated":{"line":34,"column":11}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":10},"generated":{"line":34,"column":22}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":24},"generated":{"line":34,"column":24}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":10},"generated":{"line":34,"column":35}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":37},"generated":{"line":34,"column":37}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":10},"generated":{"line":34,"column":40}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":44},"generated":{"line":34,"column":44}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":54},"generated":{"line":34,"column":54}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":57},"generated":{"line":34,"column":57}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":44},"generated":{"line":34,"column":58}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":39,"column":8},"generated":{"line":34,"column":61}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":40,"column":10},"generated":{"line":34,"column":62}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":40,"column":13},"generated":{"line":34,"column":65}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":40,"column":14},"generated":{"line":34,"column":66}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":40,"column":25},"generated":{"line":34,"column":77}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":40,"column":28},"generated":{"line":34,"column":80}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":40,"column":13},"generated":{"line":34,"column":81}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":40,"column":34},"generated":{"line":34,"column":86}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":40,"column":44},"generated":{"line":34,"column":96}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":40,"column":47},"generated":{"line":34,"column":99}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":40,"column":13},"generated":{"line":34,"column":100}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":40,"column":49},"generated":{"line":34,"column":101}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":39,"column":8},"generated":{"line":34,"column":103}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":41,"column":10},"generated":{"line":34,"column":105}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":39,"column":8},"generated":{"line":34,"column":129}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":42,"column":10},"generated":{"line":34,"column":131}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":42,"column":16},"generated":{"line":34,"column":137}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":42,"column":32},"generated":{"line":34,"column":153}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":39,"column":8},"generated":{"line":34,"column":181}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":44},"generated":{"line":34,"column":182}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":44,"column":8},"generated":{"line":34,"column":185}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":45,"column":10},"generated":{"line":34,"column":186}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":44,"column":8},"generated":{"line":34,"column":191}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":46,"column":10},"generated":{"line":34,"column":193}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":44,"column":8},"generated":{"line":34,"column":198}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":47,"column":10},"generated":{"line":34,"column":200}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":47,"column":29},"generated":{"line":34,"column":219}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":47,"column":45},"generated":{"line":34,"column":235}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":44,"column":8},"generated":{"line":34,"column":237}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":38,"column":4},"generated":{"line":34,"column":238}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":4},"generated":{"line":35,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":10},"generated":{"line":35,"column":10}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":11},"generated":{"line":35,"column":11}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":10},"generated":{"line":35,"column":21}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":23},"generated":{"line":35,"column":23}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":10},"generated":{"line":35,"column":33}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":35},"generated":{"line":35,"column":35}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":10},"generated":{"line":35,"column":38}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":42},"generated":{"line":35,"column":42}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":51},"generated":{"line":35,"column":51}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":54},"generated":{"line":35,"column":54}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":42},"generated":{"line":35,"column":55}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":50,"column":8},"generated":{"line":35,"column":58}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":51,"column":10},"generated":{"line":35,"column":59}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":51,"column":13},"generated":{"line":35,"column":62}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":51,"column":14},"generated":{"line":35,"column":63}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":51,"column":24},"generated":{"line":35,"column":73}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":51,"column":27},"generated":{"line":35,"column":76}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":51,"column":13},"generated":{"line":35,"column":77}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":51,"column":33},"generated":{"line":35,"column":82}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":51,"column":42},"generated":{"line":35,"column":91}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":51,"column":45},"generated":{"line":35,"column":94}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":51,"column":13},"generated":{"line":35,"column":95}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":51,"column":47},"generated":{"line":35,"column":96}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":50,"column":8},"generated":{"line":35,"column":98}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":52,"column":10},"generated":{"line":35,"column":100}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":50,"column":8},"generated":{"line":35,"column":123}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":53,"column":10},"generated":{"line":35,"column":125}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":53,"column":16},"generated":{"line":35,"column":131}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":53,"column":31},"generated":{"line":35,"column":146}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":50,"column":8},"generated":{"line":35,"column":173}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":42},"generated":{"line":35,"column":174}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":55,"column":8},"generated":{"line":35,"column":177}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":56,"column":10},"generated":{"line":35,"column":178}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":55,"column":8},"generated":{"line":35,"column":183}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":57,"column":10},"generated":{"line":35,"column":185}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":55,"column":8},"generated":{"line":35,"column":190}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":58,"column":10},"generated":{"line":35,"column":192}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":58,"column":29},"generated":{"line":35,"column":211}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":58,"column":44},"generated":{"line":35,"column":226}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":55,"column":8},"generated":{"line":35,"column":228}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":49,"column":4},"generated":{"line":35,"column":229}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":28,"column":32},"generated":{"line":35,"column":230}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":61,"column":4},"generated":{"line":35,"column":231}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":62,"column":4},"generated":{"line":36,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":63,"column":4},"generated":{"line":37,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":64,"column":4},"generated":{"line":39,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":64,"column":9},"generated":{"line":39,"column":9}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":64,"column":4},"generated":{"line":39,"column":17}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":64,"column":20},"generated":{"line":39,"column":20}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":65,"column":41},"generated":{"line":40,"column":41}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":65,"column":52},"generated":{"line":40,"column":52}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":66,"column":40},"generated":{"line":41,"column":40}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":66,"column":50},"generated":{"line":41,"column":50}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":82,"column":33},"generated":{"line":57,"column":33}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":82,"column":38},"generated":{"line":57,"column":38}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":86,"column":31},"generated":{"line":61,"column":31}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":86,"column":42},"generated":{"line":61,"column":42}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":87,"column":30},"generated":{"line":62,"column":30}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":87,"column":40},"generated":{"line":62,"column":40}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":89,"column":23},"generated":{"line":64,"column":23}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":89,"column":26},"generated":{"line":64,"column":26}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":90,"column":35},"generated":{"line":65,"column":35}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":90,"column":51},"generated":{"line":65,"column":51}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":91,"column":28},"generated":{"line":66,"column":28}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":91,"column":46},"generated":{"line":66,"column":46}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":94,"column":23},"generated":{"line":69,"column":23}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":94,"column":26},"generated":{"line":69,"column":26}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":95,"column":35},"generated":{"line":70,"column":35}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":95,"column":50},"generated":{"line":70,"column":50}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":96,"column":28},"generated":{"line":71,"column":28}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":96,"column":46},"generated":{"line":71,"column":46}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":101,"column":13},"generated":{"line":76,"column":13}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":101,"column":21},"generated":{"line":76,"column":21}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":64,"column":4},"generated":{"line":100,"column":5}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":126,"column":3},"generated":{"line":101,"column":0}},{"source":"../src/crop_and_resize_gpu.ts","name":null,"original":{"line":20,"column":33},"generated":{"line":103,"column":0}}],"sources":{"../src/crop_and_resize_gpu.ts":"/**\n * @license\n * Copyright 2017 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {GPGPUProgram} from './gpgpu_math';\n\nexport class CropAndResizeProgram implements GPGPUProgram {\n  variableNames = ['Image', 'Boxes', 'BoxInd'];\n  outputShape: number[] = [];\n  userCode: string;\n\n  constructor(\n      imageShape: [number, number, number, number], boxShape: [number, number],\n      cropSize: [number, number], method: 'bilinear'|'nearest',\n      extrapolationValue: number) {\n    const [batch, imageHeight, imageWidth, depth] = imageShape;\n    const [numBoxes, ] = boxShape;\n    const [cropHeight, cropWidth] = cropSize;\n    this.outputShape = [numBoxes, cropHeight, cropWidth, depth];\n    const methodId = method === 'bilinear' ? 1 : 0;\n\n    const [inputHeightFloat, inputWidthFloat] =\n        [`${imageHeight - 1}.0`, `${imageWidth - 1}.0`];\n\n    const [heightRatio, heightScale, inY] = cropHeight > 1 ?\n        [\n          `${(imageHeight - 1) / (cropHeight - 1)}`,\n          '(y2-y1) * height_ratio',\n          `y1*${inputHeightFloat} + float(y)*(height_scale)`,\n        ] :\n        [\n          '0.0',\n          '0.0',\n          `0.5 * (y1+y2) * ${inputHeightFloat}`,\n        ];\n    const [widthRatio, widthScale, inX] = cropWidth > 1 ?\n        [\n          `${(imageWidth - 1) / (cropWidth - 1)}`,\n          '(x2-x1) * width_ratio',\n          `x1*${inputWidthFloat} + float(x)*(width_scale)`,\n        ] :\n        [\n          '0.0',\n          '0.0',\n          `0.5 * (x1+x2) * ${inputWidthFloat}`,\n        ];\n\n    // Reference implementation\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/crop_and_resize_op_gpu.cu.cc\n    this.userCode = `\n      const float height_ratio = float(${heightRatio});\n      const float width_ratio = float(${widthRatio});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${batch}) {\n          return;\n        }\n\n        float height_scale = ${heightScale};\n        float width_scale = ${widthScale};\n\n        float in_y = ${inY};\n        if( in_y < 0.0 || in_y > ${inputHeightFloat} ) {\n          setOutput(float(${extrapolationValue}));\n          return;\n        }\n        float in_x = ${inX};\n        if( in_x < 0.0 || in_x > ${inputWidthFloat} ) {\n          setOutput(float(${extrapolationValue}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${methodId} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `;\n  }\n}\n"},"lineCount":null}},"error":null,"hash":"cfa25b74bf0acda90b0cb0dc8716afa7","cacheData":{"env":{}}}